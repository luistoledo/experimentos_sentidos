<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.37/Tone.js" integrity="sha512-gK8OnTXn8cTYkHqYX+bhzjQ1rClAPuG2eMy+oRuV26mSuE0EbZeULFKdyc/YGX1Z/JsC06FXxQttdX4aahjSMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </head>
    <body>
        <button id="start">start</button>
        <button id="stop">stop</button>
        <div class="slidecontainer">
          <input type="range" min="1" max="800" value="3" class="slider" id="rango">
          <input type="range" min="1" max="800" value="3" class="slider" id="rango2">
        </div>
        <canvas id="circulo" width=700 height=700></canvas>
        <script>
            let variable=100;
            let variable2=100;
            let note;
            let canvas = document.getElementById("circulo")
            let ctx = canvas.getContext("2d")
            let interval;
            let i = 10;
            let x, y, dx, dy;
            function init(){
                dx=5; dy=5;
                x=Math.random()*canvas.offsetWidth; y=Math.random()*100;
            }
            function draw() {
                ctx.fillStyle = "rgba(200,50,200,.03)";
                if (i % 100 < 0.5) ctx.fillRect(0, 0, canvas.width, canvas.height); 

                ctx.fillStyle = `rgba(${variable2/5},100,${variable/10},0.9)`;
                sw = (variable/14) + 3
                sh = (variable2/14) + 3 
                x += dx
                y += dy
                if (x+sw > canvas.offsetWidth || x < 0) dx *= -1;
                if (y+sh > canvas.offsetHeight || y < 0) dy *= -1;
                ctx.fillRect(x, y, sw, sh)

                let newValue = "D"+(variable2/50).toString();
                osc.frequency.rampTo(newValue,.4);
                osc.phase = i+variable;

                console.log("starting with ", newValue);
                osc.start();
                i = i+10;
            }

            var slider = document.getElementById("rango");
            slider.oninput = function() {
              variable = this.value;
            } 
            
            var slider2 = document.getElementById("rango2");
            slider2.oninput = function() {
                variable2 = this.value;
            }

            setInterval(()=>{ 
                slider.value = Math.random()*800
                slider2.value = Math.random()*800
                variable = slider.value
                variable2 = slider2.value
            }, 1000)

            const osc = new Tone.Oscillator("D4").toDestination();//.start().toDestination();

            document.getElementById('start')?.addEventListener('click', async () => {init(); interval = setInterval(draw,100);} )
            document.getElementById('stop')?.addEventListener('click', async () => {osc.stop(0); clearInterval(interval);} )
        </script>
    </body>
</html>
